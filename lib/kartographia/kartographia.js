if(!javaxt)var javaxt={};if(!javaxt.dhtml)javaxt.dhtml={};
if(!kartographia){var kartographia={}}kartographia.Map=function(l,F){this.className="com.kartographia.Map";var p=this;var H;var P={basemap:"osm",layers:[],center:[45,20],zoom:5,maxZoom:19,style:{info:{background:"rgba(255, 255, 255, 0.5)",fontFamily:'"MS Sans Serif",tahoma,arial,helvetica,sans-serif',fontSize:"8pt",color:"rgba(0,0,0,0.85)",cursor:"default"},coord:{padding:"0 3px 0 0",margin:"0 0 0 -5px",overflowX:"hidden",width:"100px",textAlign:"right"}},coordinateFormat:"DMS",renderers:{zoomControl:null}};var s;var u=new ol.format.WKT();var Q=new ol.source.Vector();var c=new ol.layer.Vector({source:new ol.source.Vector({})});var x;var B;var a,I,e,v;var C;var z=[];var r=-1;var K=false;var k=false;var O=function(){if(typeof l==="string"){l=document.getElementById(l)}if(!l){return}var W={};G(W,F);var V=W.basemap;if(V){delete W.basemap}G(W,P);F=W;if(V){F.basemap=V}var T=document.createElement("div");T.style.position="relative";T.style.height="100%";T.setAttribute("desc",p.className);l.appendChild(T);p.el=T;a=document.createElement("div");D(a,F.style.info);a.style.position="absolute";a.style.left=0;a.style.bottom=0;a.style.zIndex=1;T.appendChild(a);I=document.createElement("div");D(I,F.style.info);I.style.position="absolute";I.style.right=0;I.style.bottom=0;I.style.zIndex=1;T.appendChild(I);e=document.createElement("div");D(e,F.style.coord);e.style.display="inline-block";I.appendChild(e);v=e.cloneNode();I.appendChild(v);s=new ol.Map({controls:ol.control.defaults({zoom:F.renderers.zoomControl?false:true,attribution:false}),interactions:ol.interaction.defaults({doubleClickZoom:false}),target:T,view:new ol.View({center:ol.proj.transform([F.center[1],F.center[0]],"EPSG:4326","EPSG:3857"),zoom:F.zoom,maxZoom:F.maxZoom,constrainResolution:true})});H=s.getViewport();if(F.renderers.zoomControl){F.renderers.zoomControl(T)}if(F.basemap){p.addBaseMap(F.basemap,"basemap")}if(F.layers){for(var U=0;U<F.layers.length;U++){n(F.layers[U])}}n(c).set("name","featureLayer");n(new ol.layer.Vector({source:Q})).set("name","drawingLayer");var Y=new ol.style.Fill({color:[180,0,0,1]});var Z=new ol.style.Stroke({color:[180,0,0,1],width:1});var R=new ol.style.Style({image:new ol.style.Circle({fill:Y,stroke:Z,radius:3}),fill:Y,stroke:Z});c.setStyle(R);if(typeof ol.Overlay.Popup!=="undefined"){x=new ol.Overlay.Popup();s.addOverlay(x)}B=new ol.interaction.DragBox({condition:ol.events.condition.always,style:new ol.style.Style({stroke:new ol.style.Stroke({color:[0,0,255,1]})})});B.setActive(false);B.on("boxstart",function(aa){k=true;Q.clear(true)});B.on("boxend",function(aa){k=false;var ab=aa.target.getGeometry();var ac=new ol.Feature({geometry:ab.clone()});Q.addFeature(ac);var ae=J(ab);var ad=E(ae);p.onBoxSelect(ad,[ae])});var X=ol.interaction.DragBox.handleEvent;if(X){B.handleEvent=function(aa){if(aa.pointerEvent&&aa.pointerEvent.pointerType==="touch"){aa.pointerEvent.pointerType="mouse"}return X.apply(this,arguments)}}else{}s.addInteraction(B);s.on("moveend",function(){if(K===false){if(r<z.length-1){for(var aa=z.length-1;aa>r;aa--){z.pop()}}z.push({extent:s.getView().calculateExtent(s.getSize()),navStep:s.getSize(),zoom:s.getView().getZoom()});r=r+1}p.onExtentChange()});var S=function(ab){var ac=ol.proj.transform(ab.coordinate,"EPSG:3857","EPSG:4326");var aa=ac[0];if(aa<-180){while(aa<-180){aa=aa+360}}else{if(aa>180){while(aa>180){aa=aa-360}}}ac[0]=aa;return ac};s.on("pointermove",function(aa){var ab=S(aa);t(ab[1],ab[0]);p.onMouseMove(ab[1],ab[0])});s.on("singleclick",function(aa){var ab=S(aa);p.onMouseClick(ab[1],ab[0],aa.originalEvent)});s.on("contextmenu",function(aa){var ab=S(aa);p.onMouseClick(ab[1],ab[0],aa.originalEvent)});s.on("dblclick",function(aa){if(!k){var ab=S(aa);p.onDoubleClick(ab[1],ab[0])}});d(H,function(){var ad=function(){p.resize();M(l,p.resize)};var aa=H.getElementsByTagName("canvas").length;if(aa===0||isNaN(aa)){var ac;var ab=function(){var ae=H.getElementsByTagName("canvas").length;if(ae===0||isNaN(ae)){ac=setTimeout(ab,100)}else{clearTimeout(ac);if(ad){ad.apply(p,[])}}};ac=setTimeout(ab,100)}else{if(ad){ad.apply(p,[])}}})};this.getCanvas=function(){return H.getElementsByTagName("canvas")[0]};this.back=function(){if(r>0){K=true;s.getView().fit(z[r-1].extent,z[r-1].navStep);s.getView().setZoom(z[r-1].zoom);setTimeout(function(){K=false},360);r=r-1}};this.next=function(){if(r<z.length-1){K=true;s.getView().fit(z[r+1].extent,z[r+1].navStep);s.getView().setZoom(z[r+1].zoom);setTimeout(function(){K=false},360);r=r+1}};this.getMap=function(){return s};this.getStatusDiv=function(){return a};this.getCoordinateDiv=function(){return I};this.setCoordinateFormat=function(R){F.coordinateFormat=R};this.updateSize=function(){p.resize()};this.resize=function(){s.updateSize();var S=p.getCanvas();if(!S){return}var T=S.parentNode.offsetWidth;var R=S.parentNode.offsetHeight;S.style.width=T+"px";S.style.height=R+"px";p.onResize()};this.zoomIn=function(){L(true)};this.zoomOut=function(){L(false)};var L=function(T){var R=s.getView();var S=R.getZoom()+(T?1:-1);R.animate({zoom:S,duration:200})};this.getZoomLevel=function(){return s.getView().getZoom()};this.getResolution=function(){return s.getView().getResolution()};this.getProjection=function(){return s.getView().getProjection().getCode()};this.getExtent=function(){var R=s.getView();var T=R.calculateExtent(s.getSize());var S=ol.geom.Polygon.fromExtent(T);var V=J(S);var U=E(V);return U};this.setExtent=function(S,U){if(S){S=A(S);var R=s.getView();try{R.fit(S,s.getSize())}catch(T){console.log(T)}}if(U!=null){U.call()}};this.containsExtent=function(S){S=A(S);var R=s.getView().calculateExtent(s.getSize());return ol.extent.containsExtent(R,S)};var A=function(T){if(typeof(T)==="string"||T instanceof String){var S=u.readFeature(T);var R=S.getGeometry();R.transform("EPSG:4326","EPSG:3857");T=R.getExtent()}else{if(T instanceof ol.geom.Geometry){T=T.getExtent()}else{if(T instanceof ol.Feature){var R=T.getGeometry();T=R.getExtent()}}}return T};this.setCenter=function(R,T,S){s.getView().setCenter(ol.proj.transform([T,R],"EPSG:4326","EPSG:3857"));if(S){s.getView().setZoom(S)}};this.getCenter=function(){var R=s.getView().getCenter();var S=new ol.geom.Point(R).transform("EPSG:3857","EPSG:4326").getCoordinates();return[S[1],S[0]]};this.onExtentChange=function(){};this.onResize=function(){};this.beforeLoad=function(R){};this.onLoad=function(R){};this.onMouseMove=function(R,S){};this.onMouseClick=function(S,T,R){};this.onDoubleClick=function(R,S){};this.onSelect=function(){};this.onBoxSelect=function(R,S){};this.panTo=function(S,T,V){var R=s.getView();if(T!=null){var U=ol.animation.pan({duration:T,source:R.getCenter()});s.beforeRender(U)}p.setExtent(S,V)};this.popup=function(T,S){if(typeof(T)==="string"||T instanceof String){var R=u.readFeature(T);T=R.getGeometry();T.transform("EPSG:4326","EPSG:3857");T=T.getCoordinates()}x.show(T,S)};this.hidePopup=function(){x.hide()};this.enableBoxSelect=function(){if(arguments.length===1&&arguments[0]===false){B.setActive(false)}else{B.setActive(true)}};this.clearBoxSelect=function(){p.clearDrawings()};this.drawLine=function(R,S){if(R==null){R=new ol.style.Style({stroke:new ol.style.Stroke({color:"#3399cc",width:1})})}w("LineString",R,S)};this.drawPolygon=function(R,S){if(R==null){R=new ol.style.Style({image:null,stroke:new ol.style.Stroke({color:"#3399cc",width:1}),fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.4)"})})}w("Polygon",R,S)};this.clearDrawings=function(){Q.clear(true);j()};var w=function(T,S,U){j();k=true;var R=new ol.interaction.Draw({source:Q,type:T,style:S});R.on("drawstart",function(V){Q.clear(true)});R.on("drawend",function(V){setTimeout(function(){var W=V.feature.getGeometry();var Y=J(W);var X=E(Y);j();if(U){U.apply(p,[X,W])}},100)});s.addInteraction(R)};var j=function(){s.getInteractions().forEach(function(R){if(R instanceof ol.interaction.Draw){s.removeInteraction(R)}});k=false};this.addBaseMap=function(U,T){if(typeof U==="string"){var S=U.toLowerCase();if((S.indexOf("{x}")>-1&&S.indexOf("{y}")>-1&&S.indexOf("{z}")>-1)){U=new ol.layer.Tile({source:new ol.source.XYZ({url:U})})}else{if(S=="osm"){U=new ol.layer.Tile({source:new ol.source.OSM({crossOrigin:null})})}}}var R=n(U,0);if(T){R.set("name",T)}return R};this.addLayer=function(S,R){var T=s.getLayers().getLength();if(R==null){R=T-2}else{if(R>T-2){R=R-2}}return n(S,R)};var n=function(S,R){if(S==null){return}if(R!=null){s.getLayers().insertAt(R,S)}else{s.addLayer(S)}var U=S.getSource();if(U instanceof ol.source.Vector){S.addFeature=function(V){try{this.getSource().addFeature(f(V))}catch(W){console.log(W)}};S.getFeatures=function(){return this.getSource().getFeatures()};S.clear=function(){this.getSource().clear(true)};S.getExtent=function(){return this.getSource().getExtent()}}else{S.clear=function(){};S.getExtent=function(){}}S.show=function(W,X){if(isNaN(W)){this.setVisible(true)}else{var V=this.getOpacity();if(V>0){this.setOpacity(0);this.setVisible(true);m(this,0,V,W,X)}else{this.setVisible(true);if(X){X.apply(p,[this])}}}};S.hide=function(W,X){if(isNaN(W)){this.setVisible(false)}else{var V=this.getOpacity();if(V>0){m(this,V,0,W,function(Y){Y.setVisible(false);Y.setOpacity(V);if(X){X.apply(p,[Y])}})}else{this.setVisible(false);if(X){X.apply(p,[this])}}}};S.isVisible=function(){return this.getVisible()};S.setOpacity_=S.setOpacity;S.setOpacity=function(V,W,X){if(isNaN(W)){this.setOpacity_(V)}else{m(this,this.getOpacity(),V,W,X)}};if(S instanceof ol.layer.Tile){var T=S.getSource();T.on("tileloadstart",function(){p.beforeLoad(S);clearTimeout(C);a.innerHTML="Loading..."});T.on(["tileloadend","tileloaderror"],function(){clearTimeout(C);C=setTimeout(function(){a.innerHTML="";p.onLoad(S)},800)});S.refresh=function(){var V=this.getSource();V.tileCache.expireCache({});V.tileCache.clear();if(V.clear){V.refresh()}}}return S};this.getLayers=function(){return o(s.getLayers())};var o=function(R){var S=[];R.forEach(function(T){if(T instanceof ol.layer.Group){S.push(T.getLayers())}else{S.push(T)}});return S};this.removeLayer=function(R){s.removeLayer(R)};this.addFeature=function(R){c.addFeature(f(R))};var f=function(T){if(T instanceof ol.Feature){return T}else{var R;if(T!=null){if(T.geom){R=i(T.geom)}else{if(T.geometry){R=i(T.geometry)}else{R=i(T)}}}var S=new ol.Feature({});if(R){S.setGeometry(R)}return S}};var i=function(S){if(typeof S==="string"||S instanceof String){var R=u.readFeature(S);S=R.getGeometry();S.transform("EPSG:4326","EPSG:3857");return S}else{if(S instanceof ol.geom.Geometry){return S}else{return null}}};this.clearFeatures=function(){c.getSource().clear()};this.createPointLayer=function(R,T){var S=new ol.layer.Vector({source:new ol.source.Vector({}),style:h(R,T),visible:true});p.addLayer(S);q(S);return S};var h=function(R,S){if(typeof R==="string"){R=ol.color.asArray(R)}var U=new ol.style.Fill({color:R});var T=new ol.style.Stroke({color:R,width:0});return new ol.style.Style({image:new ol.style.Circle({fill:U,stroke:T,radius:S}),fill:U,stroke:T})};this.createVectorLayer=function(R){var T;if(R){T=new ol.style.Style({stroke:new ol.style.Stroke({color:R,width:1})})}else{T=new ol.layer.Vector().getStyleFunction()()}var S=new ol.layer.Vector({source:new ol.source.Vector({}),style:function(V){var W=V.get("style");if(W){return W}var X=V.get("color");var Y=V.get("fill");if(X||Y){var U={};if(X){U.stroke=new ol.style.Stroke({color:X,width:1})}if(Y){U.fill=new ol.style.Fill({color:Y})}return new ol.style.Style(U)}return T}});p.addLayer(S);q(S);return S};var q=function(R){R.getSource().addFeature(new ol.Feature({geometry:new ol.geom.Point([-20026376.39,-20048966.1]),style:new ol.style.Style({fill:new ol.style.Fill({color:ol.color.asString([0,0,0,0])})})}));R.getSource().addFeature(new ol.Feature({geometry:new ol.geom.Point([20026376.39,20048966.1]),style:new ol.style.Style({fill:new ol.style.Fill({color:ol.color.asString([0,0,0,0])})})}))};this.getTilePreview=function(S,Y,X){if(!X){return}var T=ol.proj.get("EPSG:3857");var R=function(){var Z=S.getSource().getTileUrlFunction();var aa=[3,2,3];var ab=Z(aa,1,T);if(ab){if(ab.indexOf("-4")>-1){ab=ab.replace("-4","3")}}return ab};var V=R();if(V){X.apply(p,[V])}else{var W;var U=function(){var Z=R();if(Z){clearTimeout(W);X.apply(p,[Z])}else{W=setTimeout(U,1000)}};W=setTimeout(U,1000)}};this.getTileGeom=function(aa,Y,W){var S=y(Y,W);var V=y(Y+1,W);var ac=g(aa,W);var X=g(aa+1,W);var R=[X,S];var U=[X,V];var ab=[ac,V];var T=[ac,S];var Z=[R,T,ab,U,R];return new ol.geom.Polygon([Z])};var g=function(R,S){return R/Math.pow(2,S)*360-180};var y=function(U,S){var T=Math.PI-(2*Math.PI*U)/Math.pow(2,S);var R=Math.atan(Math.sinh(T));return R*(180/Math.PI)};var b=function(V){var T=(V.getTileGrid())?V.getTileGrid():ol.tilegrid.getForProjection(s.getView().getProjection()),U=T.getZForResolution(s.getView().getResolution()),S=T.getTileRangeForExtentAndZ(s.getView().calculateExtent(s.getSize()),U),R=S.maxX-S.minX+1,W=S.maxY-S.minY+1;return R*W};var m=function(U,ac,Z,S,ab,R,T){if(!R){R=new Date().getTime()}if(!T){T=S}var V=new Date().getTime();var Y=V-R;if(T<=Y){U.setOpacity(Z);if(ab){ab.apply(p,[U])}return}T-=Y;var X=1-(T/S);var W;var aa=Math.abs(ac-Z);if(ac<Z){W=ac+(aa*X)}else{W=ac-(aa*X)}U.setOpacity(W);setTimeout(function(){m(U,ac,Z,S,ab,V,T)},33)};var J=function(T){T=T.clone().transform("EPSG:3857","EPSG:4326");var U=T.getExtent();var W=0;var R=U[0];if(R<-180){while(R<-180){R=R+360;W+=360}}else{if(R>180){while(R>180){R=R-360;W=W-360}}}var V=T.getCoordinates()[0];for(var S=0;S<V.length;S++){var X=V[S];X[0]+=W}return V};var E=function(T){var S="POLYGON((";for(var R=0;R<T.length;R++){if(R>0){S+=","}S+=T[R].join(" ")}S+="))";return S};var t=function(aa,S){if(S>180){while(S>360){S=S-360}}else{if(S<180){while(S<-360){S=S+360}}}if(S>180){S=-180-(180-S)}if(S<-180){S=180+(S+180)}var W=(aa>=0)?"N":"S";var U=(S>=0)?"E":"W";if(F.coordinateFormat==="DMS"){var Z=1;if(aa<0){Z=-1}var Y=Math.abs(Math.round(aa*1000000));var ac=1;if(S<0){ac=-1}var ab=Math.abs(Math.round(S*1000000));var T=Math.floor(((Y/1000000)-Math.floor(Y/1000000))*60);var V=Math.floor(((ab/1000000)-Math.floor(ab/1000000))*60);if(T<10){T="0"+T}if(V<10){V="0"+V}var ad=(Math.floor(((((Y/1000000)-Math.floor(Y/1000000))*60)-Math.floor(((Y/1000000)-Math.floor(Y/1000000))*60))*100000)*60/100000);var R=(Math.floor(((((ab/1000000)-Math.floor(ab/1000000))*60)-Math.floor(((ab/1000000)-Math.floor(ab/1000000))*60))*100000)*60/100000);if(ad<10){ad="0"+ad}if(R<10){R="0"+R}if(ad.toString().indexOf(".")<0){ad+=".0000"}if(R.toString().indexOf(".")<0){R+=".0000"}aa=((Math.floor(Y/1000000)*Z)+"&deg;"+T+"'"+ad);S=((Math.floor(ab/1000000)*ac)+"&deg;"+V+"'"+R);var X=(aa+"0000").split(".");if(X.length==2){X[1]=X[1].substring(0,4);aa=X[0]+"."+X[1]}X=(S+"0000").split(".");if(X.length==2){X[1]=X[1].substring(0,4);S=X[0]+"."+X[1]}aa+='" '+W;S+='" '+U}else{aa=N(aa,9)+" "+W;S=N(S,9)+" "+U}e.innerHTML=S;v.innerHTML=aa};var N=function(S,R){return Number(Math.round(parseFloat(S+"e"+R))+"e-"+R)};var G=javaxt.dhtml.utils.merge;var d=javaxt.dhtml.utils.onRender;var D=javaxt.dhtml.utils.setStyle;var M=javaxt.dhtml.utils.addResizeListener;O()};if(!com){var com={}}if(!com.kartographia){com.kartographia={}}com.kartographia.Map=kartographia.Map;
if(!com){var com={}}if(!com.kartographia){com.kartographia={}}com.kartographia.MapMenu=function(i,b){var f=this;var d={style:{thumbnail:"map-tile",label:"map-tile-label map-info"},layers:{}};var a;var j=function(){if(typeof i==="string"){i=document.getElementById(i)}if(!i){return}var k={};g(k,b);g(k,d);b=k;a=document.createElement("div");i.appendChild(a);f.update();f.el=a};this.show=function(){f.el.style.display=""};this.hide=function(){f.el.style.display="none"};this.update=function(){for(var l in b.layers){if(b.layers.hasOwnProperty(l)){var k=b.layers[l];var m=k.div;if(!m){k.div=c(k)}}}};this.onSelect=function(k){};var c=function(m){var o=document.createElement("div");e(o,b.style.thumbnail);a.appendChild(o);var l=document.createElement("div");e(l,b.style.label);l.style.zIndex=1;l.innerHTML=m.name;o.appendChild(l);var n=document.createElement("div");n.style.position="absolute";o.appendChild(n);var k=document.createElement("img");k.src=m.preview;n.appendChild(k);o.onclick=function(){f.onSelect(m)};return o};var g=javaxt.dhtml.utils.merge;var e=javaxt.dhtml.utils.setStyle;var h=javaxt.dhtml.utils.createTable;j()};
if(!com){var com={}}if(!com.kartographia){com.kartographia={}}com.kartographia.MapOverlay=function(e){var c=this;var d;var f=function(){var i=e.el.offsetWidth;var q=e.el.offsetHeight;var n=e.getProjection();var l=e.getMap();var p=l.getView();var r=p.calculateExtent(l.getSize());var m=r[0];var k=r[1];var h=r[2];var g=r[3];var o=e.overlay;if(!o){d=new com.kartographia.MapTile(m,k,h,g,i,q,n);var j=d.getCanvas();j.style.position="absolute";j.style.top=0;j.style.width="100%";j.style.height="100%";e.el.appendChild(j);e.overlay=d}else{d=e.overlay}};this.remove=function(){var g=d.getCanvas();e.el.removeChild(g);e.overlay=null};this.clear=function(){d.clear()};this.addPoint=function(j,k,g,i,h){d.addPoint(j,k,g,i,h)};this.addLine=function(i,g,h){d.addLine(i,g,h)};this.addText=function(k,i,j,g,h){d.addText(k,i,j,g,h)};this.renderTracks=function(K,H,L){if(!K){return}var p=L.tailLength;var F=L.color;var B=L.labels?L.labels.indexOf("device")>-1:false;var l=L.labels?L.labels.indexOf("telemetry")>-1:false;var z=L.speed;if(z!=null){if(z.indexOf("-")===-1){z=[0,parseFloat(z)]}else{var g=z.split("-");z=[parseFloat(g[0]),parseFloat(g[1])]}}for(var I=0;I<K.length;I++){var C=K[I];var h=b(C,H);if(h!=null){var s=h[1];var n=h[0];var o=h[3];var J=h[4];var q=J!=null?(J*2.236936):0;if(z){if(q>=z[0]&&q<=z[1]){}else{continue}}var u=null;if(B==true){u=C.id+""}if(l==true){if(q>0){q=a(q);if(q==0){q=0.1}q+=" mph";if(u==null){u=q}else{u+="\n"+q}if(o!=null){u+=", bearing "+a(o)}}}d.addPoint(s,n,F,5,u);if(o!=null||J!=null){var A=[[s,n]];var r=s;var m=n;var w=H-(p*60*1000);var N=[];for(var G=0;G<C.coords.length;G++){var M=C.coords[G];if(M[2]>=w&&M[2]<H){N.push(M)}}var y=H;for(var y=H;y>=w;y=y-(60*1000)){var v=N.length;for(var E=N.length-1;E>=0;E--){var D=N[E];if(D[2]>y){s=D[1];n=D[0];if(s!=r&&n!=m){A.push([s,n])}v--}}N.length=v;var M=b(C,y);if(M){s=M[1];n=M[0];if(s!=r&&n!=m){A.push([s,n])}r=s;m=n}}if(A.length>1){d.addLine(A,F,1)}}}}};var b=function(g,h){return com.kartographia.utils.getCoord(g.coords,h)};var a=function(g){return Math.round(g*10)/10};f()};
if(!kartographia){var kartographia={}}kartographia.MapTile=function(q,o,p,n,j,i,s){var r=this;var e=0;var d=0;var b=1;var a=1;var c,k;var l=function(){c=document.createElement("canvas");c.width=j;c.height=i;k=c.getContext("2d");if(s=="EPSG:3857"){e=q;d=n;b=j/h(p,q);a=i/h(o,n)}else{if(s=="EPSG:4326"){q=g(q);o=f(o);p=g(p);n=f(n);e=q;d=n;b=j/(p-q);a=i/(o-n)}}};this.getCanvas=function(){return c};this.getImage=function(){return k.getImageData(0,0,c.width,c.height)};this.clear=function(){k.clearRect(0,0,c.width,c.height)};this.addPoint=function(y,u,w,C,A){var v=g(u);var z=f(y);var t=C/2;k.beginPath();k.arc(v,z,t,0,2*Math.PI,false);k.fillStyle=w;k.fill();if(A!=null){var x=A.split("\n");var B=15;k.font=B+"px Arial";k.fillText(x[0],v+t,z);if(x.length>1){k.font="8px Arial";k.fillText(x[1],v+t,(z+B))}}};this.addLine=function(B,v,x){k.strokeStyle=v;if(x){k.lineWidth=x}k.beginPath();for(var w=0;w<B.length;w++){var y=B[w];var z=y[0];var t=y[1];var u=g(t);var A=f(z);if(w==0){k.moveTo(u,A)}else{k.lineTo(u,A)}}k.stroke()};this.addPolygon=function(C,A,v,x){if(v){k.fillStyle=v;k.beginPath();for(var w=0;w<C.length;w++){var y=C[w];var z=y[0];var t=y[1];var u=g(t);var B=f(z);if(w==0){k.moveTo(u,B)}else{k.lineTo(u,B)}}k.closePath();k.fill()}if(A){r.addLine(C,A,x)}};this.addText=function(z,x,y,t,v){var u=g(y);var w=f(x);k.fillStyle=t;k.font=v+"px Arial";k.fillText(z,u,w)};var g=function(u){if(s=="EPSG:3857"){var t=u*20037508.34/180;var v=h(t,e);if(t<e){v=-v}return v*b}else{if(s=="EPSG:4326"){u+=180;var t=(u-e)*b;return t}}};var f=function(t){if(s=="EPSG:3857"){var v=Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180);v=v*20037508.34/180;var u=h(v,d);if(v>d){u=-u}return u*a}else{if(s=="EPSG:4326"){t=-t;if(t<=0){t=90+-t}else{t=90-t}t=180-t;var v=(t-d)*a;if(m(v)==0||m(v)==-0){v=0}return v}}};var m=function(t){return Math.round(t)};var h=function(u,t){return Math.abs(u-t)};l()};if(!com){var com={}}if(!com.kartographia){com.kartographia={}}com.kartographia.MapTile=kartographia.MapTile;
if(!kartographia){var kartographia={}}kartographia.utils={getTileCoordinate:function(d,g,i){var c=function(m,k,l){return Math.min(Math.max(m,k),l)};var e=c(d,-85.05112878,85.05112878);var b=c(g,-180,180);var h=(b+180)/360*(1<<i);var f=(1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(d*Math.PI/180))/Math.PI)/2*(1<<i);var a=parseInt(Math.trunc(h));var j=parseInt(Math.trunc(f));return[a,j]},line2Polygon:function(v,a){var b=[];for(var w=0;w<v.length;w++){var r=v[w];b.push({x:r[0],y:r[1]})}v=b;if(!k(a)){var n=a;a=[];for(var w=0;w<v.length;w++){a.push(n)}}function m(A,t,C){var B=t.x-A.x,z=t.y-A.y,i=Math.sqrt(B*B+z*z),D=C/(2*i);return{x:-D*z,y:D*B}}function x(t,E,i,C){var A=(E.y-t.y)/(E.x-t.x),z=(C.y-i.y)/(C.x-i.x);if(Math.abs(A-z)<0.00001){return}var G=t.y-A*t.x;var F=i.y-z*i.x;var D=(G-F)/(z-A);var B=A*D+G;return{x:D,y:B}}function k(i){return(Object.prototype.toString.call(i)==="[object Array]")}var y,q,f=[],j,l,u,s,g,e,d,p,c,o;for(var w=0,h=v.length-1;w<h;w++){j=!w;l=(w===v.length-2);y=m(v[w],v[w+1],a[w]);q=m(v[w],v[w+1],a[w+1]);d={x:v[w].x+y.x,y:v[w].y+y.y};p={x:v[w+1].x+q.x,y:v[w+1].y+q.y};c={x:v[w].x-y.x,y:v[w].y-y.y};o={x:v[w+1].x-q.x,y:v[w+1].y-q.y};if(!j){g=x(u[0],u[1],d,p);if(g){f.unshift(g)}e=x(s[0],s[1],c,o);if(e){f.push(e)}}if(j){f.unshift(d);f.push(c)}if(l){f.unshift(p);f.push(o)}if(!l){u=[d,p];s=[c,o]}}for(var w=0;w<f.length;w++){var r=f[w];f[w]=[r.x,r.y]}f.push(f[0]);return f},getCoord:function(k,u){var a=null;var x=null;var s=null;var w=function(e,j){return window.getLatLon(j,e)};var b=function(j,e){return j.distanceTo(e)};var z=function(t,j){var e=t.initialBearingTo(j);return isNaN(e)?0:e};var o=function(t,A,e){var j=t.destinationPoint(A,e);return[j.longitude,j.latitude]};for(var r=0;r<k.length;r++){var q=k[r];var l=q[2];if(l>u){x=q;if(r>0){s=k[r-1];var h=s[2];if(h==l){a=s;if(r>1){s=k[r-2]}else{s=null}}}break}}if(s!=null){var p=w(s[0],s[1]);var i=s[2];var d;var v;if(s.length<4){var n;var h;if(a!=null){n=w(a[0],a[1]);h=a[2]}else{n=w(x[0],x[1]);h=x[2]}var c=b(p,n);var f=(h-i)/1000;v=c/f;d=z(p,n);s.push(d);s.push(v)}else{d=s[3];v=s[4]}var g=(u-i)/1000;var m=v*g;try{a=o(p,m,d);a.push(u);a.push(d);a.push(v)}catch(y){}}return a}};if(!com){var com={}}if(!com.kartographia){com.kartographia={}}com.kartographia.utils=kartographia.utils;